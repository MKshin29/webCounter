# webCounter

## Описание сервиса
Сервис создан при использовании технологии Spring boot. Используется БД PostgreSQL. Перед началом работ были проинициализированы таблицы БД с помощью скриптов createDB.sql и populateDB.sql в каталоге web_counter\src\main\resources\sql.

Сервис предоставляет доступ к двум функциям:

###GET /stats - предоставляет статистические данные о посещаемости ссылок. Доступен только пользователю admin.
Get-параметры запроса:
  
    dateFrom - таймштамп начала периода фильтрации данных. Обязательный параметр. Передается в веде строки в формате ddMMyyyyHHmmss или ddMMyyyy (во случае, если передан таймштамп без времени, то автоматически будет подставлено 000000, то есть 00 часов, 00 минут, 00 секунд). Например дата 12 декабря 2020 года 18 часов 23 минуты 55 секунд будет выглядеть так: 12122020182355. Или можно передать только дату, например  12 декабря 2020 года - 12122020 - в фильтре применится как 12 декабря 2020 года 00 часов 00 минуты 00 секунд.
    dateTo - таймштамп конца периода фильтрации данных. Обязательный параметр. Передается в веде строки в формате ddMMyyyyHHmmss или ddMMyyyy (во случае, если передан таймштамп без времени, то автоматически будет подставлено 000000, то есть 00 часов, 00 минут, 00 секунд). Например дата 12 декабря 2020 года 18 часов 23 минуты 55 секунд будет выглядеть так: 12122020182355. Или можно передать только дату, например  12 декабря 2020 года - 12122020 - в фильтре применится как 12 декабря 2020 года 00 часов 00 минуты 00 секунд.
  username - имя пользователя (идентификатор). Не обязательный параметр. Передается в виде строки без пробела. Например "user" или "pikachu".
  
Пример запроса: http://localhost:8080/stats?dateFrom=19122020&dateTo=20122020

Пример ответа: {"all_visits":33,"uniq_users":2,"constant_users":1}

Описание полей ответа: 
    all_visits - количество посещений за указаный период.
    uniq_users - количество уникальный пользователей, переходившим по ссылкам, в указаном периоде
    constant_users - количество постоянных пользователей (тех, у кого 10 и более посещений в указаном периоде)
    
В случае передачи в запросе параметра dateFrom или dateTo в неверном формате, ответ будет содержать ошибку http 400 и сообщение {"error":1}
В случае попытки доступа пользователем, отличным от admin, ответ будет содержать ошибку 403. 

### POST /savevisit - предоставляет возможность оставить запись о посещении конкретного url. Доступна всем пользователям.
Пример тела запроса:

{
    "username": "user",
    "ulr": "http://google.com"
}

    username - текстовое поле. 
    ulr - текстовое поле. 
 
 В случае, если пользователь, указанный в запросе, отсутствует в базе данных в таблице users, то сервер ответ ошибкой 400 с сообщением:
    Пример запроса 
{
  "username": "admin111",
  "url": "http://vk.com/profile/12"
}
    ответ
{
    "result": "Error. User not specified"
}

  В случае, если ссылка, указанная в запросе отсутствует в базе данных в таблице sites, то будет создана новая запись в этой таблице, и будет добавлена запись о посещении. 
    Пример запроса
{
  "username": "admin",
  "url": "http://vk.com/profile/12255"
}
    Пример ответа:
{
    "result": "Success. Added new record"
}

Сборка производится в плагине maven для IntellIJIdea. 

